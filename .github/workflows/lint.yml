name: Lint

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  shellcheck:
    name: ShellCheck
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install ShellCheck
        run: sudo apt-get install -y shellcheck
      - name: Run ShellCheck on shell scripts
        run: |
          find . -name '*.sh' -o -name '*.sh.tmpl' \
            | grep -v '.git/' \
            | while read -r file; do
                # Strip chezmoi template directives for linting
                sed 's/{{.*}}//g' "$file" | shellcheck -s bash - || true
              done
      - name: Check zsh files syntax
        run: |
          for f in dot_zshenv dot_config/zsh/*.zsh dot_config/zsh/dot_zshrc; do
            if [ -f "$f" ]; then
              echo "Checking $f..."
              zsh -n "$f" 2>&1 || true
            fi
          done

  yaml-lint:
    name: YAML Lint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Lint YAML files
        uses: ibiqlik/action-yamllint@v3
        with:
          file_or_dir: .
          config_data: |
            extends: default
            rules:
              line-length:
                max: 120
              truthy: disable

  markdown-lint:
    name: Markdown Lint
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: DavidAnson/markdownlint-cli2-action@v19
        with:
          globs: '**/*.md'

  editorconfig:
    name: EditorConfig Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: editorconfig-checker/action-editorconfig-checker@main
      - run: editorconfig-checker
